# üé§ Companion Voice Setup - Railway Environment Variables

## Required Environment Variables for Eleven Labs Voice

Add these to your Railway project:

### 1. Get Your Eleven Labs Credentials

1. Sign up at https://elevenlabs.io/
2. Go to your profile ‚Üí API Keys
3. Copy your API key
4. Go to VoiceLab ‚Üí Select a voice ‚Üí Copy Voice ID

### 2. Add to Railway

In your Railway project settings, add:

```env
ELEVENLABS_API_KEY=your_api_key_here
ELEVENLABS_VOICE_ID=your_voice_id_here
```

**Example:**
```env
ELEVENLABS_API_KEY=sk_abc123def456ghi789jkl012mno345pqr678stu901
ELEVENLABS_VOICE_ID=21m00Tcm4TlvDq8ikWAM
```

### 3. Voice Recommendations

For Study OS companion, use voices that are:
- **Age:** 25-35 (mature but relatable)
- **Tone:** Confident, motivating
- **Energy:** Medium-high
- **Style:** Professional coach

**Recommended Voices:**
- `Adam` - Deep, authoritative
- `Antoni` - Warm, encouraging  
- `Josh` - Young professional energy
- `Sam` - Neutral, clear

### 4. Test Your Setup

After adding the env vars and redeploying:

```bash
# Test welcome message
curl https://cerabellumos-production.up.railway.app/api/companion/welcome \
  -H "x-user-id: test-user-123"

# Should return:
{
  "text": "Morning champion. Ready to dominate today?...",
  "emotion": "encouraging",
  "audioBase64": "//uQx... (base64 audio data)",
  "timestamp": "2024-01-15T08:00:00.000Z"
}
```

### 5. How Voice Works

```
User opens app
    ‚Üì
Backend: GET /api/companion/welcome
    ‚Üì
Eleven Labs: Text ‚Üí Speech (MP3)
    ‚Üì
Backend: Encode to base64
    ‚Üì
Frontend: Decode & play audio
    ‚Üì
Companion: Shows talking_open expression
    ‚Üì
User hears personalized voice
```

### 6. Voice Emotions

The system uses different voice settings based on context:

| Emotion | Stability | Style | Use Case |
|---------|-----------|-------|----------|
| `calm` | 0.75 | 0.0 | Default, idle messages |
| `urgent` | 0.5 | 0.4 | Exam alerts, drift warnings |
| `hype` | 0.4 | 0.6 | Celebrations, momentum |
| `encouraging` | 0.65 | 0.2 | Coaching, support |

### 7. Voice Trigger Events

**Welcome Messages:**
- First app open of the day
- Personalized based on study data
- Auto-plays on home tab

**Coaching Messages:**
- Generated by AI Coaching System
- Auto-plays first unheard message
- Synced with companion animation

**Pattern Observations:**
- "I noticed you study better at 9pm..."
- "Your focus is 3x higher with Pomodoro..."

**Exam Countdowns:**
- 7 days: Strategic planning
- 3 days: Urgent focus mode
- 1 day: Final review reminder

### 8. Cost Estimate

Eleven Labs pricing (as of 2024):
- **Free Tier:** 10,000 characters/month
- **Starter:** $5/month - 30,000 chars
- **Creator:** $22/month - 100,000 chars

**Study OS Usage:**
- Welcome message: ~150 chars/day
- Coaching message: ~200 chars each
- Average: 500-1000 chars/day/user

**Monthly cost for 100 active users:**
- 100 users √ó 30 days √ó 500 chars = 1.5M chars/month
- Recommended: Creator plan ($22/month)

### 9. Fallback Behavior

If Eleven Labs is not configured:
- ‚úÖ System still works
- ‚úÖ Companion shows talking animation
- ‚ùå No audio playback
- ‚ö†Ô∏è Console warning: "Eleven Labs not configured"

### 10. Debugging

**No voice playing?**

1. Check Railway logs:
   ```
   üé§ Generating speech (calm): "Morning champion..."
   ‚úÖ Speech generated successfully (45231 bytes)
   ```

2. Check Flutter logs:
   ```
   üé§ Playing voice message: "Morning champion..."
   üé§ Audio already playing, skipping...
   ‚úÖ Voice message playback complete
   ```

3. Verify env vars are set in Railway dashboard

4. Test endpoint directly:
   ```bash
   curl https://your-railway-url.up.railway.app/api/companion/speak \
     -X POST \
     -H "Content-Type: application/json" \
     -H "x-user-id: test-user-123" \
     -d '{"text":"This is a test","emotion":"calm"}'
   ```

---

## üöÄ RESULT:

Your companion will now:
- ‚úÖ Greet users with personalized voice every day
- ‚úÖ Speak coaching messages automatically  
- ‚úÖ Deliver pattern observations with voice
- ‚úÖ Alert users with urgent voice warnings
- ‚úÖ Celebrate achievements with hype energy
- ‚úÖ Sync talking animation with audio playback

**NO MORE SILENT AI. COMPANION IS NOW ALIVE!** üî•üéØ

